{"version":3,"sources":["../src/dropdown.js"],"names":["KeyCodes","TAB","SHIFT","ESCAPE","ARROW_UP","ARROW_DOWN","Selectors","DATA_DROPDOWN","DATA_TARGET","DATA_PARENT","DATA_VISIBLE","TABINDEX","ARIA_HASPOPUP","ARIA_CONTROLS","ARIA_LABELLEDBY","ARIA_EXPANDED","ROLE","Events","KEYDOWN","CLICK","Messages","NO_DROPDOWN_ID_ERROR","NO_MENU_ERROR","attr","NO_DROPDOWN_ITEMS_ERROR","NO_DROPDOWN_BUTTONS_ERROR","NO_PARENT_ERROR","Dropdown","_render","bind","_handleFirstTabClose","_handleLastTabClose","_renderWithKeys","_handleClose","_handleEscapeKeyPress","_handleOffMenuClick","_activeDropdown","_activeDropdownButton","_activeDropdownMenu","_activeDropdownLinks","_allowFocusReturn","_activeDropdownId","_activeDropdownAttr","_activeDropdownMenuId","_firstDropdownLink","_lastDropdownLink","_dropdownButtons","_dropdowns","_dropdownContainerAttr","_dropdownTargetAttr","dom","findAll","length","forEach","instance","_setup","button","addEventListener","removeEventListener","dropdownId","getAttribute","Error","dropdownAttr","dropdownButton","find","dropdownMenu","id","dropdownMenuItemsAttr","dropdownMenuListItems","item","dropdownMenuButtons","_getDropdownLinks","link","event","key","preventDefault","stopPropagation","_handleOpenDropdown","target","_setActiveDropdownId","_setActiveDropdown","_setActiveDropdownMenu","_setVisibleState","_listenToClose","_startEvents","focus","iOSMobile","css","document","body","releaseFocus","_handleHideState","_listenToRender","_stopEvents","_handleReturnFocus","captureFocus","useArrows","shiftKey","which","tabKey","TAB_INDEX","Utils"],"mappings":"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","sourcesContent":["import Utils, { iOSMobile, dom } from \"./utils\"\n\nconst KeyCodes = {\n  TAB: 9,\n  SHIFT: 16,\n  ESCAPE: 27,\n  ARROW_UP: 38,\n  ARROW_DOWN: 40,\n}\n\nconst Selectors = {\n  // unique\n  DATA_DROPDOWN: \"data-dropdown\",\n  // common\n  DATA_TARGET: \"data-target\",\n  DATA_PARENT: \"data-parent\",\n  DATA_VISIBLE: \"data-visible\",\n  // accessibility\n  TABINDEX: \"tabindex\",\n  ARIA_HASPOPUP: \"aria-haspopup\",\n  ARIA_CONTROLS: \"aria-controls\",\n  ARIA_LABELLEDBY: \"aria-labelledby\",\n  ARIA_EXPANDED: \"aria-expanded\",\n  ROLE: \"role\",\n}\n\nconst Events = {\n  KEYDOWN: \"keydown\",\n  CLICK: \"click\",\n}\n\nconst Messages = {\n  NO_DROPDOWN_ID_ERROR:\n    \"Could not setup dropdown. Make sure it has a valid [data-dropdown] attribute with a unique id as its value.\",\n  NO_MENU_ERROR: attr => `Could not find menu associated with ${attr}.`,\n  NO_DROPDOWN_ITEMS_ERROR: attr => `Could not find any list items associated with ${attr}.`,\n  NO_DROPDOWN_BUTTONS_ERROR: attr =>\n    `Could not find any button or anchor elements associated with ${attr}.`,\n  NO_PARENT_ERROR: \"Could not find dropdown button's [data-parent] attribute.\",\n}\n\nexport default class Dropdown extends Utils {\n  constructor() {\n    super()\n\n    // events\n    this._render = this._render.bind(this)\n    this._handleFirstTabClose = this._handleFirstTabClose.bind(this)\n    this._handleLastTabClose = this._handleLastTabClose.bind(this)\n    this._renderWithKeys = this._renderWithKeys.bind(this)\n    this._handleClose = this._handleClose.bind(this)\n    this._handleEscapeKeyPress = this._handleEscapeKeyPress.bind(this)\n    this._handleOffMenuClick = this._handleOffMenuClick.bind(this)\n\n    // active dropdown\n    this._activeDropdown = {}\n    this._activeDropdownButton = null\n    this._activeDropdownMenu = {}\n    this._activeDropdownLinks = []\n    this._allowFocusReturn = true\n    this._activeDropdownId = \"\"\n    this._activeDropdownAttr = \"\"\n    this._activeDropdownMenuId = \"\"\n    this._firstDropdownLink = {}\n    this._lastDropdownLink = {}\n\n    // all dropdowns\n    this._dropdownButtons = []\n    this._dropdowns = []\n\n    // dropdown element selectors\n    this._dropdownContainerAttr = `[${Selectors.DATA_DROPDOWN}]`\n    this._dropdownTargetAttr = `[${Selectors.DATA_TARGET}]`\n  }\n\n  // public\n\n  start() {\n    this._dropdowns = dom.findAll(`${this._dropdownContainerAttr}`)\n    this._dropdownButtons = dom.findAll(\n      `${this._dropdownContainerAttr} > ${this._dropdownTargetAttr}`\n    )\n\n    if (this._dropdowns.length) {\n      this._dropdowns.forEach(instance => this._setup(instance))\n    }\n\n    this._dropdownButtons.forEach(button => {\n      button.addEventListener(Events.CLICK, this._render)\n      button.addEventListener(Events.KEYDOWN, this._renderWithKeys)\n    })\n  }\n\n  stop() {\n    this._dropdownButtons.forEach(button => {\n      button.removeEventListener(Events.CLICK, this._render)\n      button.removeEventListener(Events.KEYDOWN, this._renderWithKeys)\n    })\n  }\n\n  // private\n\n  _setup(instance) {\n    const dropdownId = instance.getAttribute(Selectors.DATA_DROPDOWN)\n\n    if (!dropdownId) {\n      throw new Error(Messages.NO_DROPDOWN_ID_ERROR)\n    }\n\n    const dropdownAttr = `[${Selectors.DATA_DROPDOWN}=\"${dropdownId}\"]`\n    const dropdownButton = dom.find(`${dropdownAttr} > ${this._dropdownTargetAttr}`)\n\n    if (!dom.attr(dropdownButton, Selectors.DATA_PARENT)) {\n      throw new Error(Messages.NO_PARENT_ERROR)\n    }\n\n    const dropdownMenu = dom.find(`${dropdownAttr} > ul`)\n\n    if (!dropdownMenu) {\n      throw new Error(Messages.NO_MENU_ERROR(dropdownAttr))\n    }\n\n    dom.attr(dropdownMenu, Selectors.ARIA_LABELLEDBY, dropdownButton.id)\n\n    dom.attr(dropdownButton, Selectors.ARIA_CONTROLS, dropdownMenu.id)\n    dom.attr(dropdownButton, Selectors.ARIA_HASPOPUP, \"true\")\n    dom.attr(dropdownButton, Selectors.ARIA_EXPANDED, \"false\")\n\n    const dropdownMenuItemsAttr = `${dropdownAttr} > ul > li`\n    const dropdownMenuListItems = dom.findAll(dropdownMenuItemsAttr)\n\n    if (!dropdownMenuListItems.length) {\n      throw new Error(Messages.NO_DROPDOWN_ITEMS_ERROR(dropdownAttr))\n    }\n\n    dropdownMenuListItems.forEach(item => dom.attr(item, Selectors.ROLE, \"none\"))\n\n    const dropdownMenuButtons = this._getDropdownLinks(dropdownAttr)\n\n    if (!dropdownMenuButtons.length) {\n      throw new Error(Messages.NO_DROPDOWN_BUTTONS_ERROR(dropdownAttr))\n    }\n\n    dropdownMenuButtons.forEach(link => {\n      dom.attr(link, Selectors.ROLE, \"menuitem\")\n      dom.attr(link, Selectors.TABINDEX, \"-1\")\n    })\n  }\n\n  _render(event, key) {\n    event.preventDefault()\n    event.stopPropagation()\n    this._handleOpenDropdown(event)\n\n    this._activeDropdownButton = event.target\n\n    this._setActiveDropdownId()\n    this._setActiveDropdown()\n    this._setActiveDropdownMenu()\n    this._setVisibleState()\n    this._listenToClose()\n    this._startEvents()\n\n    if (key && key === KeyCodes.ARROW_UP) {\n      this._lastDropdownLink.focus()\n    } else {\n      this._firstDropdownLink.focus()\n    }\n\n    if (iOSMobile) dom.css(document.body, \"cursor\", \"pointer\")\n  }\n\n  _handleClose(event) {\n    event.preventDefault()\n\n    if (iOSMobile) dom.css(document.body, \"cursor\", \"auto\")\n\n    this.releaseFocus()\n    this._handleHideState()\n    this._listenToRender()\n\n    this._stopEvents()\n\n    if (this._allowFocusReturn) {\n      this._handleReturnFocus()\n    }\n\n    this._activeDropdownButton = null\n    this._activeDropdownId = null\n    this._activeDropdown = null\n  }\n\n  _listenToRender() {\n    this._activeDropdownButton.removeEventListener(Events.CLICK, this._handleClose)\n    this._activeDropdownButton.addEventListener(Events.CLICK, this._render)\n  }\n\n  _handleHideState() {\n    dom.attr(this._activeDropdownButton, Selectors.ARIA_EXPANDED, \"false\")\n    dom.attr(this._activeDropdown, Selectors.DATA_VISIBLE, \"false\")\n\n    this._activeDropdownLinks.forEach(link => {\n      dom.attr(link, Selectors.TABINDEX, \"-1\")\n      link.removeEventListener(Events.CLICK, this._handleClose)\n    })\n  }\n\n  _stopEvents() {\n    document.removeEventListener(Events.KEYDOWN, this._handleEscapeKeyPress)\n    document.removeEventListener(Events.CLICK, this._handleOffMenuClick)\n  }\n\n  _setActiveDropdownId() {\n    this._activeDropdownId = dom.attr(this._activeDropdownButton, Selectors.DATA_PARENT)\n  }\n\n  _startEvents() {\n    document.addEventListener(Events.KEYDOWN, this._handleEscapeKeyPress)\n    document.addEventListener(Events.CLICK, this._handleOffMenuClick)\n\n    this._activeDropdownLinks = this._getDropdownLinks(this._activeDropdownAttr)\n\n    this._firstDropdownLink = this._activeDropdownLinks[0]\n    this._lastDropdownLink = this._activeDropdownLinks[this._activeDropdownLinks.length - 1]\n\n    this._firstDropdownLink.addEventListener(Events.KEYDOWN, this._handleFirstTabClose)\n    this._lastDropdownLink.addEventListener(Events.KEYDOWN, this._handleLastTabClose)\n\n    this._activeDropdownLinks.forEach(link => {\n      dom.attr(link, Selectors.TABINDEX, \"0\")\n      link.addEventListener(Events.CLICK, this._handleClose)\n    })\n\n    this.captureFocus(`${this._activeDropdownAttr} > ul`, { useArrows: true })\n  }\n\n  _listenToClose() {\n    this._activeDropdownButton.removeEventListener(Events.CLICK, this._render)\n    this._activeDropdownButton.addEventListener(Events.CLICK, this._handleClose)\n  }\n\n  _setVisibleState() {\n    dom.attr(this._activeDropdownButton, Selectors.ARIA_EXPANDED, \"true\")\n    dom.attr(this._activeDropdown, Selectors.DATA_VISIBLE, \"true\")\n  }\n\n  _setActiveDropdownMenu() {\n    this._activeDropdownMenuId = dom.attr(this._activeDropdownButton, Selectors.DATA_TARGET)\n    this._activeDropdownMenu = dom.find(`#${this._activeDropdownMenuId}`)\n  }\n\n  _setActiveDropdown() {\n    this._activeDropdownAttr = `[${Selectors.DATA_DROPDOWN}=\"${this._activeDropdownId}\"]`\n    this._activeDropdown = dom.find(this._activeDropdownAttr)\n  }\n\n  _handleOpenDropdown(event) {\n    if (!this._activeDropdownButton) return\n\n    this._allowFocusReturn = false\n    this._handleClose(event)\n    this._allowFocusReturn = true\n  }\n\n  _handleFirstTabClose(event) {\n    const shiftKey = event.which === KeyCodes.SHIFT || event.shiftKey\n    const tabKey = event.which === KeyCodes.TAB\n\n    if (shiftKey && tabKey) {\n      this._handleClose(event)\n    }\n  }\n\n  _handleLastTabClose(event) {\n    const shiftKey = event.which === KeyCodes.SHIFT || event.shiftKey\n    const tabKey = event.which === KeyCodes.TAB\n\n    if (tabKey && !shiftKey) {\n      this._handleClose(event)\n    }\n  }\n\n  _renderWithKeys(event) {\n    if (event.which === KeyCodes.ARROW_UP || event.which === KeyCodes.ARROW_DOWN) {\n      this._render(event, event.which)\n    }\n  }\n\n  _handleEscapeKeyPress(event) {\n    if (event.which === KeyCodes.ESCAPE) {\n      this._handleClose(event)\n    }\n  }\n\n  _handleOffMenuClick(event) {\n    if (event.target !== this._activeDropdownButton && event.target !== this._activeDropdownMenu) {\n      this._handleClose(event)\n    }\n  }\n\n  _handleReturnFocus() {\n    dom.attr(this._activeDropdownButton, Selectors.TAB_INDEX, \"-1\")\n    this._activeDropdownButton.focus()\n    dom.attr(this._activeDropdownButton, Selectors.TAB_INDEX, false)\n  }\n\n  _getDropdownLinks(attr) {\n    return dom.findAll(`${attr} > ul > li > a, ${attr} > ul > li > button`)\n  }\n}\n"],"file":"dropdown.js"}