{"version":3,"sources":["../src/tooltip.js"],"names":["KeyCodes","ESCAPE","Selectors","DATA_TOOLTIP","DATA_VISIBLE","DATA_TARGET","ROLE","ARIA_DESCRIBEDBY","DROP_LEFT_CLASS","DROP_RIGHT_CLASS","Events","CLICK","MOUSEOVER","MOUSEOUT","FOCUS","BLUR","KEYDOWN","Messages","NO_ID_ERROR","NO_TRIGGER_ERROR","id","NO_TOOLTIP_ERROR","Tooltip","_render","bind","_handleClose","_handleEscapeKeyPress","_activeTrigger","_activeTooltip","_allTooltips","dom","findAll","forEach","instance","_setup","attr","trigger","find","_getTrigger","removeEventListener","tooltipId","Error","tooltip","addEventListener","event","target","getAttribute","document","getElementById","_isLeftOrRight","_alignTooltip","_setVisibleState","_startCloseEvents","_setHideState","_startOpenEvents","iOSMobile","css","body","which","property","triggerSize","_getSize","tooltipSize","triggerIsBigger","offset","element","Math","floor","getBoundingClientRect","hasClass"],"mappings":"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","sourcesContent":["import { iOSMobile, dom } from \"./utils\"\n\nconst KeyCodes = {\n  ESCAPE: 27,\n}\n\nconst Selectors = {\n  // unique\n  DATA_TOOLTIP: \"data-tooltip\",\n  // common\n  DATA_VISIBLE: \"data-visible\",\n  DATA_TARGET: \"data-target\",\n  // accessibility\n  ROLE: \"role\",\n  ARIA_DESCRIBEDBY: \"aria-describedby\",\n  // classes\n  DROP_LEFT_CLASS: \"is-drop-left\",\n  DROP_RIGHT_CLASS: \"is-drop-right\",\n}\n\nconst Events = {\n  CLICK: \"click\",\n  MOUSEOVER: \"mouseover\",\n  MOUSEOUT: \"mouseout\",\n  FOCUS: \"focus\",\n  BLUR: \"blur\",\n  KEYDOWN: \"keydown\",\n}\n\nconst Messages = {\n  NO_ID_ERROR: \"Could not find your tooltip's id.\",\n  NO_TRIGGER_ERROR: id => `Could not find a tooltip trigger with id of ${id}.`,\n  NO_TOOLTIP_ERROR: id => `Could not find a tooltip with id of ${id}.`,\n}\n\nexport default class Tooltip {\n  constructor() {\n    // events\n    this._render = this._render.bind(this)\n    this._handleClose = this._handleClose.bind(this)\n    this._handleEscapeKeyPress = this._handleEscapeKeyPress.bind(this)\n\n    // active tooltip\n    this._activeTrigger = null\n    this._activeTooltip = null\n\n    // all tooltips\n    this._allTooltips = []\n  }\n\n  // public\n\n  start() {\n    this._allTooltips = dom.findAll(`[${Selectors.DATA_TOOLTIP}]`)\n\n    this._allTooltips.forEach(instance => {\n      this._setup(instance)\n    })\n  }\n\n  stop() {\n    this._allTooltips.forEach(instance => {\n      const id = dom.attr(instance, Selectors.DATA_TOOLTIP)\n      const trigger = dom.find(this._getTrigger(id), instance)\n\n      if (this._activeTooltip || this._activeTrigger) {\n        this._handleClose()\n      }\n\n      trigger.removeEventListener(Events.MOUSEOVER, this._render)\n      trigger.removeEventListener(Events.FOCUS, this._render)\n    })\n  }\n\n  // private\n\n  _setup(instance) {\n    const tooltipId = dom.attr(instance, Selectors.DATA_TOOLTIP)\n\n    if (!tooltipId) {\n      throw new Error(Messages.NO_ID_ERROR)\n    }\n\n    const trigger = dom.find(this._getTrigger(tooltipId), instance)\n    const tooltip = dom.find(`#${tooltipId}`, instance)\n\n    if (!trigger) {\n      throw new Error(Messages.NO_TRIGGER_ERROR(tooltipId))\n    }\n\n    if (!tooltip) {\n      throw new Error(Messages.NO_TOOLTIP_ERROR(tooltipId))\n    }\n\n    dom.attr(trigger, Selectors.ARIA_DESCRIBEDBY, tooltipId)\n    dom.attr(tooltip, Selectors.ROLE, \"tooltip\")\n    trigger.addEventListener(Events.MOUSEOVER, this._render)\n    trigger.addEventListener(Events.FOCUS, this._render)\n  }\n\n  _render(event) {\n    this._activeTrigger = event.target\n\n    const tooltipId = this._activeTrigger.getAttribute(Selectors.DATA_TARGET)\n    this._activeTooltip = document.getElementById(tooltipId)\n\n    if (this._isLeftOrRight()) {\n      this._alignTooltip(\"height\")\n    } else {\n      this._alignTooltip(\"width\")\n    }\n\n    this._setVisibleState()\n    this._startCloseEvents()\n  }\n\n  _handleClose() {\n    this._setHideState()\n    this._startOpenEvents()\n\n    this._activeTrigger = null\n    this._activeTooltip = null\n  }\n\n  _setVisibleState() {\n    dom.attr(this._activeTooltip, Selectors.DATA_VISIBLE, \"true\")\n  }\n\n  _setHideState() {\n    dom.attr(this._activeTooltip, Selectors.DATA_VISIBLE, \"false\")\n  }\n\n  _startCloseEvents() {\n    this._activeTrigger.removeEventListener(Events.MOUSEOVER, this._render)\n    this._activeTrigger.removeEventListener(Events.FOCUS, this._render)\n    this._activeTrigger.addEventListener(Events.MOUSEOUT, this._handleClose)\n    this._activeTrigger.addEventListener(Events.BLUR, this._handleClose)\n    document.addEventListener(Events.KEYDOWN, this._handleEscapeKeyPress)\n\n    if (iOSMobile) {\n      dom.css(document.body, \"cursor\", \"pointer\")\n    }\n  }\n\n  _handleEscapeKeyPress(event) {\n    if (event.which === KeyCodes.ESCAPE) {\n      this._handleClose()\n    }\n  }\n\n  _startOpenEvents() {\n    this._activeTrigger.removeEventListener(Events.MOUSEOUT, this._handleClose)\n    this._activeTrigger.removeEventListener(Events.BLUR, this._handleClose)\n    this._activeTrigger.addEventListener(Events.MOUSEOVER, this._render)\n    this._activeTrigger.addEventListener(Events.FOCUS, this._render)\n    document.removeEventListener(Events.KEYDOWN, this._handleEscapeKeyPress)\n\n    if (iOSMobile) dom.css(document.body, \"cursor\", \"auto\")\n  }\n\n  _alignTooltip(property) {\n    const triggerSize = this._getSize(this._activeTrigger, property)\n    const tooltipSize = this._getSize(this._activeTooltip, property)\n    const triggerIsBigger = triggerSize > tooltipSize\n\n    const offset = triggerIsBigger\n      ? (triggerSize - tooltipSize) / 2\n      : (tooltipSize - triggerSize) / -2\n\n    if (property === \"height\") {\n      dom.css(this._activeTooltip, \"top\", `${offset}px`)\n    } else {\n      dom.css(this._activeTooltip, \"left\", `${offset}px`)\n    }\n  }\n\n  _getTrigger(id) {\n    return `[${Selectors.DATA_TARGET}=\"${id}\"]`\n  }\n\n  _getSize(element, property) {\n    return Math.floor(element.getBoundingClientRect()[property])\n  }\n\n  _isLeftOrRight() {\n    return dom.hasClass(this._activeTooltip, Selectors.DROP_LEFT_CLASS, Selectors.DROP_RIGHT_CLASS)\n  }\n}\n"],"file":"tooltip.js"}