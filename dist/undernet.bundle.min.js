/*!
  * @license MIT (https://github.com/geotrev/undernet/blob/master/LICENSE)
  * Undernet v0.1.0 (https://undernet.io)
  * Copyright 2017-2018 George Treviranus
  */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.undernet=e()}(this,function(){"use strict";var n=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},o=function(){function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}}(),i=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},a=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},c=16,u=9,s={FOCUSABLE_SELECTOR:":not(.is-visually-hidden)",FOCUSABLE_TAGS:["a","button","input","object","select","textarea","[tabindex]"]},r="keydown",l=function(){function t(){n(this,t),this.handleFocusTrap=this.handleFocusTrap.bind(this)}return o(t,[{key:"getElements",value:function(t){var e=document.querySelectorAll(t);return Array.apply(null,e)}},{key:"getFocusableElements",value:function(e){var n=[];return s.FOCUSABLE_TAGS.map(function(t){return n.push(e+" "+t+s.FOCUSABLE_SELECTOR)}),this.getElements(n.join(", "))}},{key:"captureFocus",value:function(t){this.focusContainer=t;var e=this.getFocusableElements(this.focusContainer);this.focusableFirstChild=e[0],this.focusableLastChild=e[e.length-1],document.addEventListener(r,this.handleFocusTrap)}},{key:"handleFocusTrap",value:function(t){var e=document.activeElement,n=e===document.querySelector(this.focusContainer),o=e===this.focusableFirstChild,i=e===this.focusableLastChild,a=t.which===u,s=t.which===c||t.shiftKey,r=s&&a,l=!s&&a;this.releaseFocus(),this.captureFocus(this.focusContainer),r&&(o||n)?(t.preventDefault(),this.focusableLastChild.focus()):l&&i&&(t.preventDefault(),this.focusableFirstChild.focus())}},{key:"releaseFocus",value:function(){document.removeEventListener(r,this.handleFocusTrap)}}]),t}(),d=27,h="data-modal",v="data-modal-id",f="data-modal-visible",m="data-modal-close",y="data-modal-button",g="no-scroll",b="keydown",p="click",C="touchstart",A="Your button is missing its corresponding modal. Check to make sure your modal is in the DOM, and that is has a [data-modal-id=*] attribute matching the button ID.",t=function(t){function e(){n(this,e);var t=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.closeButtonAttr="["+m+"]",t.modalContainerAttr="["+h+"]",t.modals=null,t.modalButtons=null,t.closeButtons=null,t.bodyTag=document.body,t.htmlTag=document.querySelector("html"),t.getModal=t.getModal.bind(t),t.handleModalClose=t.handleModalClose.bind(t),t.handleEscapeKeyPress=t.handleEscapeKeyPress.bind(t),t.handleOverlayClick=t.handleOverlayClick.bind(t),t}return i(e,l),o(e,[{key:"start",value:function(){var e=this;this.modals=this.getElements("["+h+"]"),this.modalButtons=this.getElements("["+y+"]"),this.closeButtons=this.getElements(this.closeButtonAttr),this.modals.length&&this.modals.forEach(function(t){t.setAttribute("aria-modal","true"),t.setAttribute("role","dialog")}),this.modalButtons.length&&this.modalButtons.forEach(function(t){t.addEventListener(p,e.getModal)})}},{key:"stop",value:function(){var e=this;this.modalButtons.forEach(function(t){t.removeEventListener(p,e.getModal)})}},{key:"getModal",value:function(t){t.preventDefault(),this.renderModal(t)}},{key:"renderModal",value:function(t){var e=this;if(this.modalButton=t.target,this.modalOverlayAttr="["+v+"='"+this.modalButton.id+"']",this.modalOverlay=document.querySelector(this.modalOverlayAttr),!this.modalOverlay)throw A;this.activeModalSelector=this.modalOverlayAttr+" "+this.modalContainerAttr,this.activeModal=document.querySelector(this.activeModalSelector),this.modalCloseButtons=this.getElements(this.modalOverlayAttr+" "+this.closeButtonAttr),this.handleScrollStop(),this.captureFocus(this.activeModalSelector),this.modalOverlay.setAttribute("aria-hidden","false"),this.activeModal.setAttribute("tabindex","-1"),this.modalOverlay.setAttribute(f,""),this.activeModal.focus(),this.modalOverlay.scrollTop=0,document.addEventListener(b,this.handleEscapeKeyPress),document.addEventListener(p,this.handleOverlayClick),document.addEventListener(C,this.handleOverlayClick),this.modalCloseButtons.forEach(function(t){t.addEventListener(p,e.handleModalClose)})}},{key:"handleModalClose",value:function(t){var e=this;t.preventDefault(),this.modalOverlay.removeAttribute(f),this.handleReturnFocus(),this.handleScrollRestore(),this.releaseFocus(),this.modalOverlay.setAttribute("aria-hidden","true"),this.activeModal.removeAttribute("tabindex"),document.removeEventListener(b,this.handleEscapeKeyPress),document.removeEventListener(p,this.handleOverlayClick),document.removeEventListener(C,this.handleOverlayClick),this.modalCloseButtons.forEach(function(t){t.removeEventListener(p,e.handleModalClose)})}},{key:"handleOverlayClick",value:function(t){t.target===this.modalOverlay&&this.handleModalClose(t)}},{key:"handleEscapeKeyPress",value:function(t){t.which===d&&this.handleModalClose(t)}},{key:"handleReturnFocus",value:function(){this.modalButton.setAttribute("tabindex","-1"),this.modalButton.focus(),this.modalButton.removeAttribute("tabindex")}},{key:"handleScrollRestore",value:function(){this.bodyTag.classList.remove(g),this.htmlTag.classList.remove(g)}},{key:"handleScrollStop",value:function(){this.bodyTag.classList.add(g),this.htmlTag.classList.add(g)}}]),e}(),E=32,S="data-accordion",k="data-accordion-expanded",O="data-accordion-button",B="data-accordion-content",L="data-accordion-toggle-multiple",w="data-accordion-parent",x="aria-expanded",F="aria-hidden",M="click",T="keydown",_="You have an accordion button that is missing its content block or its [data-accordion-content] attribute.",e=function(t){function e(){n(this,e);var t=a(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t.accordionButtons=null,t.accordionContents=null,t.activeContainer=null,t.renderAccordionContent=t.renderAccordionContent.bind(t),t.handleSpaceKeyPress=t.handleSpaceKeyPress.bind(t),t}return i(e,l),o(e,[{key:"start",value:function(){var e=this;this.accordionButtons=this.getElements("["+O+"]"),this.accordionContents=this.getElements("["+B+"]"),this.accordionButtons.length&&this.accordionButtons.forEach(function(t){e.setupButton(t),t.addEventListener(M,e.renderAccordionContent),t.addEventListener(T,e.handleSpaceKeyPress)}),this.accordionContents.length&&this.accordionContents.forEach(function(t){var e="true"===t.parentNode.getAttribute(k)?"false":"true";t.setAttribute(F,e)})}},{key:"stop",value:function(){var e=this;this.accordionButtons.forEach(function(t){t.removeEventListener(M,e.renderAccordionContent),t.removeEventListener(T,e.handleSpaceKeyPress)})}},{key:"setupButton",value:function(t){var e=t.parentNode.parentNode.getAttribute(k),n=t.parentNode.nextElementSibling;"true"===e?(n.style.maxHeight=n.scrollHeight+"px",t.setAttribute(x,"true")):t.setAttribute(x,"false")}},{key:"renderAccordionContent",value:function(t){t.preventDefault(),this.activeButton=t.target,this.activeRow=this.activeButton.parentNode.parentNode,this.activeContainerId=this.activeButton.getAttribute(w),this.activeContainerAttr="["+S+"='"+this.activeContainerId+"']",this.activeContainer=document.querySelector(this.activeContainerAttr);var e=this.activeButton.getAttribute(O);if(this.activeContent=document.getElementById(e),!this.activeContent.hasAttribute(B))throw _;var n=this.activeRow.getAttribute(k),o=this.activeContent.getAttribute(B);this.toggleExpandState="true"===n?"false":"true",this.toggleContentState="visible"===o?"hidden":"visible",this.toggleHiddenState="false"===this.toggleExpandState?"true":"false",this.closeAllIfToggleable(),this.toggleSelectedAccordion()}},{key:"handleSpaceKeyPress",value:function(t){t.which===E&&this.renderAccordionContent(t)}},{key:"closeAllIfToggleable",value:function(){var e=this;if(!this.activeContainer.hasAttribute(L)){var t=this.getElements(this.activeContainerAttr+" ["+k+"]"),n=this.getElements(this.activeContainerAttr+" ["+B+"]"),o=this.getElements(this.activeContainerAttr+" ["+O+"]");n.forEach(function(t){t!==e.activeContent&&(t.style.maxHeight=null)}),this.toggleAttributeInCollection(t,k,"true","false"),this.toggleAttributeInCollection(o,x,"true","false"),this.toggleAttributeInCollection(n,F,"false","true"),this.toggleAttributeInCollection(n,B,"visible","hidden")}}},{key:"toggleSelectedAccordion",value:function(){this.activeRow.setAttribute(k,this.toggleExpandState),this.activeContent.setAttribute(B,this.toggleContentState),this.activeButton.setAttribute(x,this.toggleExpandState),this.activeContent.setAttribute(F,this.toggleHiddenState),this.activeContent.style.maxHeight?this.activeContent.style.maxHeight=null:this.activeContent.style.maxHeight=this.activeContent.scrollHeight+"px"}},{key:"toggleAttributeInCollection",value:function(t,e,n,o){t.forEach(function(t){t.hasAttribute(e,n)&&t.setAttribute(e,o)})}}]),e}(),Undernet={modals:new t,accordions:new e,start:function(){Undernet.modals.start(),Undernet.accordions.start()},stop:function(){Undernet.modals.stop(),Undernet.accordions.stop()}};return window.Undernet=Undernet});
//# sourceMappingURL=undernet.bundle.min.js.map
